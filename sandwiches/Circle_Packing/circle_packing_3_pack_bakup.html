<DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <title>Circle Packing</title>
  <script src="../../libraries/d3.v3.min.js"></script>        <!-- d3 library -->
  <script src="../../libraries/sandwich.js"></script>        <!-- core d3 sandwich library -->
  <script src="circle_packing.js"></script>
  <link href="../../sandwich.css" rel="stylesheet" media="screen">      <!-- sandwich's CSS -->
  <link href="circle_packing.css" rel="stylesheet">
</head>
<body>
<div id="container">

<div id="sandwich-heading">
  <h1> <img src="../../images/sandwich_icon.jpeg"  height="50" width="50">  d3 sandwich </h1>
  <div id="sandwich-border"></div>
</div>

<h2>Circle Packing</h2>
<h2>Step #3: Generate the Circle Packing Layout</h2>

<p>With the <a href="../Abstract_Map_1/abstract_state_0_recipe.html">Abstract State Map</a>, we told the browser exactly where to put each state's rectangle and text. Although the commands for doing that looked a little weird the first time we saw them, telling it where they should go was pretty straightforward. But what if you want to create a much more complicated data visualization like our Circle packing graph? Trying to do that by hand would be really painful.</p>
<p> Luckily, D3 has some really powerful built-in functions called "layouts" that'll do all the math for you. In this step, we'll learn how to use the one for Circle packing.</p>

<div class="recipe_row">
<div class="recipe_text">
Here's the code to do all the fancy math needed to figure out where the circles and their labels will go:
</div>
<div class="recipe_code">
<pre>
var diameter = 860;

var packedLayout = d3.layout.pack()
        .size([diameter, diameter])
        .value(function(d) { return d.quantity; });
    var packedNodes = packedLayout.nodes(produce);
</pre>
</div>
</div>  <!-- end recipe_row -->
<p> As you can see, it only takes a handful of lines.<p>
<div class="recipe_row">
<div class="recipe_text">
  <p> Use  the variable <b>diameter</b> to store the diameter of the entire graph</p>
</div>
<div class="recipe_code">
  <pre>
    var diameter = 860;
  </pre>
</div>
</div>  <!-- end recipe_row -->

<div class="recipe_row">
<div class="recipe_text">
Create a circle packed layout where:
<ul><li> The size of the overall layout is the <b>diameter</b></li>
  <li>The layout will use <b>quality</b> to calculate the size of each circle</li></ul>
</div>
<div class="recipe_code">
  <pre>
    var packedLayout = d3.layout.pack()
        .size([diameter, diameter])
        .value(function(d) { return d.quantity; });
  </pre>
</div>
</div>  <!-- end recipe_row -->

<div class="recipe_row">
<div class="recipe_text">
  <p> Do all the fancy math needed for our packed circles by applying the layout to the JSON in <b>produce</b></p>
</div>
<div class="recipe_code">
  <pre>
    var packedNodes = packedLayout.nodes(produce);
  </pre>
</div>
</div>  <!-- end recipe_row -->

<p> You may be wondering, what does the actual math created by the Circle packing layout look like? Let's take a quick peek.</p>
<div class="toy" id="create_layout">
  <div class="recipe_row">
    <div class="recipe_text">
        <div id="svg_location"> </div>        <!-- SVG graphics will be inserted here  -->
    </div>
      <div class="recipe_code">
        <form>
        </form>
        <div id="layout">
        <br/>
          Here's the end result:
          <table><tbody>
          <tr class="header"> <th> name </th><th> x </th><th> y </th><th> r </th><th> children </th> </tr>
          </tbody>
          </table>
        </div>
      </div>  <!-- end recipe_code -->
  </div>     <!-- end recipe_row -->
</div>  <!-- end toy -->




<script type="text/javascript">
var ToyID = 'create_layout';
currentJSON =  getCircleItems();

function round (num) {
  return Math.round(num)
};
displaylayoutResults = function()  {
  console.log('hiya kids!');
  getSVG(ToyID).selectAll('*').remove();      // Delete the old data viz
  var updatedJSON = createJSONFromInputFields(ToyID, currentJSON);
  DoCirclePacking('update', 'create_layout', updatedJSON, 'svg_location');

  var packedLayout = d3.layout.pack()
      .size([Diameter, Diameter])
      .value(function(d) { return d.quantity; });
  var packedNodes = packedLayout.nodes(updatedJSON);

   d3.select("table")
   .selectAll("tr")
      .data(packedNodes)
      // .enter().append("tr")
      .html(function(d,i)  {
        line = "<td>" + d.name + "</td><td>" +
        round(d.x) +  "</td><td>" + round(d.y) + "</td><td>" + round(d.r) + "</td>";
      children = d.children ? "true" : "false";
      return line + "<td>" + children + "</td>"
    });


};

DoCirclePacking('create', 'create_layout', currentJSON, 'svg_location');
UpdateFunction[ToyID] = displaylayoutResults;
createInputFieldsfromJSON(ToyID, currentJSON);

var packedLayout = d3.layout.pack()
    .size([Diameter, Diameter])
    .value(function(d) { return d.quantity; });
var packedNodes = packedLayout.nodes(currentJSON);

 d3.select("table")
 .selectAll("tr")
    .data(packedNodes)
    .enter().append("tr")
    .html(function(d,i)  {
      line = "<td>" + d.name + "</td><td>" +
      round(d.x) +  "</td><td>" + round(d.y) + "</td><td>" + round(d.r) + "</td>";
    children = d.children ? "true" : "false";
    return line + "<td>" + children + "</td>"
  });


</script>


<h4> Up Next: <a href="circle_packing_4_groups.html">Recipe Step #4: Create the Groups to Store the Circles and Text </a></h4>

<div id= "sandwich-footer">
</div> <!-- end sandwich-footer -->
</div><!-- end container -->
</body>
</html>
