<DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abstract State Map: Basic Recipe</title>
  <script src="http://d3js.org/d3.v3.min.js"></script>        <!-- d3 library -->
  <link href="../../sandwich.css" rel="stylesheet" media="screen">      <!-- sandwich's CSS -->
  <script src="abstract_state.js"></script>
</head>
<body>
  <div id="container">

    <div id="sandwich-heading">
      <h1> <img src="../../sandwich_icon.jpeg"  height="50" width="50">  d3 sandwich </h1>
      <div id="sandwich-border"></div>
    </div>

      <h2> Abstract State Map</h2>
      <h2>   Step #2: Create a Rectangle for Each State </h2>

<p> Usually when you are just starting to learn a programming language, they start off with something very simple – e.g., printing the words "hello world!" At each step, they tried to make sure you only have 1 or 2 concepts you need to wrap your head around.</p>

<p> But with D3, to do something at all useful you need to tackle a bunch of concepts at the same time. So what we're going to do is start by giving you a chance to play with a few settings in the finished code, then step back and systematically unpack the concepts behind the code one by one.</p>

<h3>Playing with the Code</h3>

<div class="recipe_row">
<div class="recipe_text">
<p>Before we dive into the code for creating the rectangles, let's get a very rough feel for how it works.</p>
<p>Play with the values and see what happens.</p>
</div>
<div class="recipe_code">
  <pre class="code_play">
    var width = <i id="width">40</i>, height = <i id="height">40</i>, cellsize = <i id= "cellsize">39</i>;
    svg_area = d3.select("svg")

    // Insert a rectangle for each state
    svg_area.selectAll("rect")
        .data(state_map)
      .enter()
      .append("rect")
        .attr("x", function(d,i)  { return d.col * width;})
        .attr("y", function(d,i) {return d.row * height;})
        .attr("width", cellsize)
        .attr("height", cellsize)
        .style("fill", "<i id="fill">DarkRed</i>");
  </pre>
</div>
</div>  <!-- end recipe_row -->

<div class="recipe_row">
<div class="recipe_text">
  <svg width="520" height="400" class="code_play" class="code_play" class="SVG_playground"></svg>        <!-- SVG graphics will go here  -->

  <script type="text/javascript">
    svgName = 'svg.code_play';

    console.log("SVG map we are going to use:" + svgName);
    make_rectangles(svgName, get_states(), [], 0, 0);
  </script>

</div>
<div class="recipe_code">
  <form class="code_play">
    <table class="input_table">
      <tr><td>Width</td><td><input name="width" type="text" value="40"> </td></tr>
      <tr><td>Height</td><td><input name="height" type="text" value="40"> </td></tr>
      <tr><td>Cell Size</td><td><input name="cellsize" type="text" value="39"> </td></tr>
      <tr><td>Fill</td><td><input name="fill" type="text" value="DarkRed"> </td></tr>
      <tr><td></td><td><input type="button" value="Update the Map"  onClick="updateValue('code_play', this)"> </td></tr>
    </table>
  </form>
</div>
</div>  <!-- end recipe_row -->
<script type="text/javascript">

  // Captains log:
  //  So what I've learned:
  //    In Firefox, on Change works just fine for Step 1 and, on my local drive, for Step 2, but not on GitHub Step 2
  //  It Internet Explorer, on change works just fine for Step 1 but not at all for Step 2
  //
  // So for step 2, I need to switch to using an update button
  // I also need to document this _in the code_ as well as somewhere else, so I won't bang my head against this will again
  //
  //
  // Break the state map code up so that creating the text is done separately,
  //  so I can just create the rectangles while still having the code to create the whole map
  //
  // Rewrite changeValue so that you pass it an anonymous function that has the code you need to use

  var state_rects =  d3.select(svgName)
      .selectAll("rect");

  var values = {width: 40, height: 40, cellsize: 39, fill: "Sienna"};
  // Better yet, I could grab one rectangle and get these values from it, I think  :-)

  function updateCodeValue(formID, valueID, newValue) {
    // Updates the value of a line of code and highlights the line
    fullID = 'pre.' + formID  + " #" + valueID;
    console.log('fullID:' + fullID);
    d3.select(fullID)
      .text(newValue)
      .style("background-color", '#FFFF66');
  };
  //
  // function changeValue(attribute, input) {
  //   updateCodeValue('code_play_form', attribute, input.value);
  //   // state_rects.attr(attribute, input.value);
  //   values[attribute] = input.value;
  //   state_rects
  //     .attr("x", function(d,i)  { return d.col * values['width'];})
  //     .attr("y", function(d,i) {return d.row * values['height'];})
  //     .attr("width", values['cellsize'])
  //     .attr("height", values['cellsize'])
  //     .style("fill",  values['fill']);
  //     // .style("fill",  "Red");
  // };

  function updateValue(playName, input)  {

      // Load the form values into the "values" object
      var playForm = "form." + playName;
      var values = {};
      // var formValues =  d3.select(playForm)
      //     .selectAll("input")[0]    //  comes back as an array within an array, so drop the outer array
      //     .slice(0,-1);     // drop the button that's at the end of the form;  switch to using a filter?
      // formValues.forEach(function(d, i) { console.log(d.name + " " + i); values[d.name] = d.value; });
      // console.log("Color is: " + values.fill);
      d3.select(playForm)
          .selectAll("input")[0]    //  comes back as an array within an array, so drop the outer array
          .slice(0,-1)     // drop the button that's at the end of the form;  switch to using a filter?
          .forEach(function(d, i) {
              values[d.name] = d.value;
              updateCodeValue(playName, d.name, d.value);
          });
      console.log("fill is: " + values.fill);

      state_rects
        .attr("x", function(d,i)  { return d.col * values.width;})
        .attr("y", function(d,i) {return d.row * values.height;})
        .attr("width", values.cellsize)
        .attr("height", values.cellsize)
        .style("fill",  values.fill);
        // .style("fill",  "Red");

  };


  //
  //
  //
  // function changeRecipeFill(input)  {
  //   updateCodeValue('fillLine', 'fill', input.value);
  // };


</script>



<h3>Revenge of Your High School Math Teacher</h3>
<p>
  (what's a rectangle and what does it have to do with high school math?)
</p>





<div class="recipe_row">
<div class="recipe_text">
  <svg width="500" height="160"  class="rectangle">
  <rect x="50" y="20" width="40" height="40"
   style="fill:DarkRed" />
  </svg>        <!-- SVG graphics will go here  -->
</div>
<div class="recipe_code">
  <form class="rectangle">
    <table class="input_table">
      <tr><td>X</td><td><input name="X" type="text" value="50"> </td></tr>
      <tr><td>Y</td><td><input name="Y" type="text" value="20"> </td></tr>
      <tr><td>Width</td><td><input name="width" type="text" value="40"> </td></tr>
      <tr><td>Height</td><td><input name="height" type="text" value="40"> </td></tr>
      <tr><td>Fill</td><td><input name="fill" type="text" value="DarkRed"> </td></tr>
      <tr><td></td><td><input type="button" value="Update It!"  onClick="updateRectangle('rectangle', this)"> </td></tr>
    </table>
  </form>
</div>
</div>  <!-- end recipe_row -->



  <script type="text/javascript">
    svgName = 'svg.rectangle';
    console.log("SVG map we are going to use:" + svgName);


    var rectangle =  d3.select(svgName).select("rect");
  </script>

<script type="text/javascript">


// Need to redo updateValue so it gets passed the anonymous function containing the update



function updateRectangle(playName, input)  {
    var playForm = "form." + playName;
    var values = {};
    d3.select(playForm)
        .selectAll("input")[0]    //  comes back as an array within an array, so drop the outer array
        .slice(0,-1)     // drop the button that's at the end of the form;  switch to using a filter?
        .forEach(function(d, i) {
            values[d.name] = d.value;
        });
    console.log("fill is: " + values.fill);

    rectangle
      .attr("x", values.X)
      .attr("y", values.Y)
      .attr("width", values.width)
      .attr("height", values.height)
      .style("fill",  values.fill);
};
</script>


<p>
  (explain and demonstrate the "border" trick)
</p>


<h3> Select, data, enter weirdness</h3>


<h3>Revenge, Part 2: why that calculation for height?</h3>



<h3>anonymous function weirdness</h3>




        <div id= "sandwich_footer">
        </div>
      </div>
    </body>
    </html>
